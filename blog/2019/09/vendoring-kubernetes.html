<!DOCTYPE html><html lang="en">
                <head><!-- 2024-10-30 Wed 21:32 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vendoring Kubernetes</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" defer href="/assets/css/poole.css?h=d4c8bf3844a984ce26b99e74d3750776a70782e2" />
<link rel="stylesheet" type="text/css" defer href="/assets/css/syntax.css?h=102da81e21102498e275df50a416d53add236a32" />
<link rel="stylesheet" type="text/css" defer href="/assets/css/hyde.css?h=f619a950377712fd9b3e13662631545173d17b73" />
<link rel="stylesheet" type="text/css" defer href="/assets/css/sidebar.css?h=d57642712e1d28963037b0140dfbb2612f66e961" />
<link rel="stylesheet" type="text/css" defer href="/assets/css/global.css?h=991168e6967807cd5a82c4caf3d974edbd40ac45" />
<link rel="stylesheet" type="text/css" defer href="/assets/css/fontawesome.css?h=19a185a2abbb0cdd1203a3aa0b8213b2417e7fb0" />
<link rel="stylesheet" type="text/css" defer href="//fonts.googleapis.com/css?family=PT+Sans%3A400%2C400italic%2C700%7CAbril+Fatface" />
</head>
                <body><div class="content container">
                                    <div class="post">
                                      <h1 class="post-title">Vendoring Kubernetes</h1><span class="post-date">2019-09-06</span><p>
Despite using Kubernetes as a module is not encouraged, there are some
projects that are following this approach.
</p>

<p>
In order to make this easier, now that we have <a href="https://github.com/kubernetes/kubernetes/issues/68577#issuecomment-480514862">go modules in
Kubernetes</a>, I wrote a small tool called <a href="https://github.com/ereslibre/vendor-kubernetes"><code>vendor-kubernetes</code></a>.
</p>

<p>
It is highly recommended that you have <code>kubernetes</code> cloned into a
directory, along with all the staging repositories that will be
reported on the resulting <code>go.mod</code> file, such as:
</p>

<div class="org-example-container"><pre class="example">
~ &gt; tree -L 1 ~/projects/go/src/k8s.io
/home/ereslibre/projects/go/src/k8s.io
├── api
├── apiextensions-apiserver
├── apimachinery
├── apiserver
├── autoscaler
├── client-go
├── cli-runtime
├── cloud-provider
├── cluster-bootstrap
├── code-generator
├── component-base
├── cri-api
├── csi-translation-lib
├── kops
├── kubeadm
├── kube-aggregator
├── kube-controller-manager
├── kubectl
├── kubelet
├── kube-proxy
├── kubernetes
├── kube-scheduler
├── legacy-cloud-providers
├── metrics
├── node-api
├── sample-apiserver
├── sample-cli-plugin
├── sample-controller
├── test-infra
└── website

30 directories, 0 files
</pre></div>

<p>
The usage is very straightforward, you have to pass a
<code>--kubernetes-version</code> argument, and optionally a <code>--kubernetes-path</code>
argument, like:
</p>

<div class="org-example-container"><pre class="example">
~/p/g/s/g/e/vendor-kubernetes (master) &gt; go run -mod=vendor main.go --kubernetes-tag 1.16.0-beta.1 --kubernetes-path ~/projects/go/src/k8s.io
require (
  k8s.io/kubernetes v1.16.0-beta.1
)

replace (
  k8s.io/api =&gt; k8s.io/api v0.0.0-20190822053644-6185379c914a
  k8s.io/apiextensions-apiserver =&gt; k8s.io/apiextensions-apiserver v0.0.0-20190822063004-0670dc4fec4e
  k8s.io/apimachinery =&gt; k8s.io/apimachinery v0.0.0-20190820074809-31b1e1ea64dc
  k8s.io/apiserver =&gt; k8s.io/apiserver v0.0.0-20190822060508-785eacbd19ae
  k8s.io/cli-runtime =&gt; k8s.io/cli-runtime v0.0.0-20190822063658-442a64f3fed7
  k8s.io/client-go =&gt; k8s.io/client-go v0.0.0-20190822054823-0a74433fb222
  k8s.io/cloud-provider =&gt; k8s.io/cloud-provider v0.0.0-20190822065847-2058b41dfbb6
  k8s.io/cluster-bootstrap =&gt; k8s.io/cluster-bootstrap v0.0.0-20190822065536-566e5fc137f7
  k8s.io/code-generator =&gt; k8s.io/code-generator v0.0.0-20190820100630-060a3d12ce80
  k8s.io/component-base =&gt; k8s.io/component-base v0.0.0-20190822055535-1f6a258f5d89
  k8s.io/cri-api =&gt; k8s.io/cri-api v0.0.0-20190820110325-95eec93e2395
  k8s.io/csi-translation-lib =&gt; k8s.io/csi-translation-lib v0.0.0-20190822070154-f51cd605b3ee
  k8s.io/kube-aggregator =&gt; k8s.io/kube-aggregator v0.0.0-20190822061015-a4f93a8219ed
  k8s.io/kube-controller-manager =&gt; k8s.io/kube-controller-manager v0.0.0-20190822065235-826221481525
  k8s.io/kube-proxy =&gt; k8s.io/kube-proxy v0.0.0-20190822064323-7e0495d8a3ff
  k8s.io/kube-scheduler =&gt; k8s.io/kube-scheduler v0.0.0-20190822064931-4470440ed041
  k8s.io/kubectl =&gt; k8s.io/kubectl v0.0.0-20190822071625-14af4a63a1e1
  k8s.io/kubelet =&gt; k8s.io/kubelet v0.0.0-20190822064626-fa8f3d935631
  k8s.io/legacy-cloud-providers =&gt; k8s.io/legacy-cloud-providers v0.0.0-20190822070624-3a30a18bba71
  k8s.io/metrics =&gt; k8s.io/metrics v0.0.0-20190822063337-6c03eb8600ee
  k8s.io/node-api =&gt; k8s.io/node-api v0.0.0-20190822070940-24e163ffb9e7
  k8s.io/sample-apiserver =&gt; k8s.io/sample-apiserver v0.0.0-20190822061642-ab22eab63834
  k8s.io/sample-cli-plugin =&gt; k8s.io/sample-cli-plugin v0.0.0-20190822064016-bcca3cc588da
  k8s.io/sample-controller =&gt; k8s.io/sample-controller v0.0.0-20190822062306-1b561d990eb5
)
</pre></div>

<p>
If you are missing any of the mentioned dependencies,
<code>vendor-kubernetes</code> will clone it in memory and resolve the date and
commit in an automatic fashion:
</p>

<div class="org-example-container"><pre class="example">
~/p/g/s/g/e/vendor-kubernetes (master) &gt; rm -rf ~/projects/go/src/k8s.io/cluster-bootstrap/
~/p/g/s/g/e/vendor-kubernetes (master) &gt; go run -mod=vendor main.go --kubernetes-tag 1.16.0-beta.1 --kubernetes-path ~/projects/go/src/k8s.io
project /home/ereslibre/projects/go/src/k8s.io/cluster-bootstrap not found; cloning project https://github.com/kubernetes/cluster-bootstrap in memory
require (
  k8s.io/kubernetes v1.16.0-beta.1
)

replace (
  k8s.io/api =&gt; k8s.io/api v0.0.0-20190822053644-6185379c914a
  k8s.io/apiextensions-apiserver =&gt; k8s.io/apiextensions-apiserver v0.0.0-20190822063004-0670dc4fec4e
  k8s.io/apimachinery =&gt; k8s.io/apimachinery v0.0.0-20190820074809-31b1e1ea64dc
  k8s.io/apiserver =&gt; k8s.io/apiserver v0.0.0-20190822060508-785eacbd19ae
  k8s.io/cli-runtime =&gt; k8s.io/cli-runtime v0.0.0-20190822063658-442a64f3fed7
  k8s.io/client-go =&gt; k8s.io/client-go v0.0.0-20190822054823-0a74433fb222
  k8s.io/cloud-provider =&gt; k8s.io/cloud-provider v0.0.0-20190822065847-2058b41dfbb6
  k8s.io/cluster-bootstrap =&gt; k8s.io/cluster-bootstrap v0.0.0-20190822065536-566e5fc137f7
  k8s.io/code-generator =&gt; k8s.io/code-generator v0.0.0-20190820100630-060a3d12ce80
  k8s.io/component-base =&gt; k8s.io/component-base v0.0.0-20190822055535-1f6a258f5d89
  k8s.io/cri-api =&gt; k8s.io/cri-api v0.0.0-20190820110325-95eec93e2395
  k8s.io/csi-translation-lib =&gt; k8s.io/csi-translation-lib v0.0.0-20190822070154-f51cd605b3ee
  k8s.io/kube-aggregator =&gt; k8s.io/kube-aggregator v0.0.0-20190822061015-a4f93a8219ed
  k8s.io/kube-controller-manager =&gt; k8s.io/kube-controller-manager v0.0.0-20190822065235-826221481525
  k8s.io/kube-proxy =&gt; k8s.io/kube-proxy v0.0.0-20190822064323-7e0495d8a3ff
  k8s.io/kube-scheduler =&gt; k8s.io/kube-scheduler v0.0.0-20190822064931-4470440ed041
  k8s.io/kubectl =&gt; k8s.io/kubectl v0.0.0-20190822071625-14af4a63a1e1
  k8s.io/kubelet =&gt; k8s.io/kubelet v0.0.0-20190822064626-fa8f3d935631
  k8s.io/legacy-cloud-providers =&gt; k8s.io/legacy-cloud-providers v0.0.0-20190822070624-3a30a18bba71
  k8s.io/metrics =&gt; k8s.io/metrics v0.0.0-20190822063337-6c03eb8600ee
  k8s.io/node-api =&gt; k8s.io/node-api v0.0.0-20190822070940-24e163ffb9e7
  k8s.io/sample-apiserver =&gt; k8s.io/sample-apiserver v0.0.0-20190822061642-ab22eab63834
  k8s.io/sample-cli-plugin =&gt; k8s.io/sample-cli-plugin v0.0.0-20190822064016-bcca3cc588da
  k8s.io/sample-controller =&gt; k8s.io/sample-controller v0.0.0-20190822062306-1b561d990eb5
)
</pre></div>

<p>
Please, note that Kubernetes itself is not meant to be used as a
module (subcomponents are). In the meantime, this tool can help you to
get your <code>go.mod</code> right.
</p>

<hr>

<p>
<i class="fab fa-github"></i> GitHub repository: <a href="https://github.com/ereslibre/vendor-kubernetes">https://github.com/ereslibre/vendor-kubernetes</a>
</p>
  </div><!-- post -->
   </div><!-- content --><div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <p class="lead"><img id="avatar" alt="My avatar" src="//s.gravatar.com/avatar/bdc4bd9b9b18388588ed2273adaee8a6?s=128" /></p>
      <p class="lead">Libre Software lover. Hacker.</p>
    </div>
    <nav class="sidebar-nav">
      <div class="sidebar-nav-item">
        <i class="fas fa-home"></i><a href="/">Home</a>
      </div>
      <div class="sidebar-nav-item">
        <i class="fas fa-envelope"></i><a href="/contact.html">Contact</a>
      </div>
      <div class="sidebar-nav-item">
        <i class="fas fa-rss-square"></i><a href="/blog/feed.xml">RSS</a>
      </div>
    </nav>
    <nav class="sidebar-nav">
      <div class="sidebar-nav-item">
        <i class="fab fa-github"></i><a href="https://github.com/ereslibre">GitHub</a>
      </div>
      <div class="sidebar-nav-item">
        <i class="fab fa-mastodon"></i><a rel="me" href="https://hachyderm.io/@ereslibre">Mastodon</a>
      </div>
      <div class="sidebar-nav-item">
        <i class="fab fa-keybase"></i><a href="https://keybase.io/ereslibre">Keybase</a>
      </div>
      <div class="sidebar-nav-item">
        <i class="fab fa-linkedin"></i><a href="https://linkedin.com/in/rafaelfernandezlopez">LinkedIn</a>
      </div>
    </nav>
    <p><a href="https://github.com/ereslibre/ereslibre.es">Built</a> with <a href="https://orgmode.org/">org-mode</a>.</p>
  </div>
</div>
</body>
              </html>
